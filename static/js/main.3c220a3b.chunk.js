(this["webpackJsonptype-tetris"]=this["webpackJsonptype-tetris"]||[]).push([[0],{12:function(t,e,a){},13:function(t,e,a){},15:function(t,e,a){"use strict";a.r(e);var c=a(1),n=a.n(c),r=a(3),i=a.n(r),o=(a(12),a(4)),s=a(5),u=a(7),l=a(6);a(13);function p(t){switch(t.case){case"nil":return{case:"nil"};case"cons":return{case:"cons",head:t.head,tail:p(t.tail)}}}function d(t){var e=[];return function t(a){switch(a.case){case"nil":return;case"cons":return e.push(a.head),void t(a.tail)}}(t),e.reverse()}function h(t){switch(t.case){case"unit":return"Unit";case"variable":return v(t.id);case"arrow":return"(".concat(h(t.domain)," -> ").concat(h(t.codomain),")")}}function v(t){return m[t%m.length]+(t>m.length?Math.floor(t/m.length).toString():"")}function b(t){switch(t.case){case"unit":return"unit";case"variable":return f(t.id);case"abstraction":return"(\u03bb ".concat(b(t.body),")");case"application":return"(".concat(b(t.applicant)," ").concat(b(t.argument),")");case"hole":return w(t.id)}}function f(t){return t.toString()}function w(t){return"?".concat(t)}function y(t){switch(t.case){case"unit":return"unit";case"variable":return"(".concat(f(t.id),": ").concat(h(t.type),")");case"abstraction":return"(\u03bb ".concat(y(t.body),"): ").concat(h(t.type));case"application":return"(".concat(y(t.applicant)," ").concat(y(t.argument),"): ").concat(h(t.type));case"hole":return"(".concat(w(t.id),": ").concat(h(t.type),")")}}var m=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];function g(t,e){switch(t.case){case"nil":return e;case"cons":return g(t.tail,{case:"cons",key:t.key,value:t.value,tail:e})}}function j(t,e){return{case:"cons",key:t,value:e,tail:{case:"nil"}}}function x(t){return d(t).map((function(t,e){return"".concat(e,": ").concat(h(t))})).join(", ")}function k(t){var e=0;function a(){var t={case:"variable",id:e};return e++,t}return function t(e,c){switch(c.case){case"unit":return{case:"unit"};case"variable":var n=O(e,c.id);return{case:"variable",id:c.id,type:n};case"abstraction":var r=a(),i=t({case:"cons",head:r,tail:e},c.body);return{case:"abstraction",body:i,type:{case:"arrow",domain:r,codomain:T(i)}};case"application":return{case:"application",applicant:t(e,c.applicant),argument:t(e,c.argument),type:a()};case"hole":var o=a();return{case:"hole",id:c.id,type:o}}throw new Error("impossible")}({case:"nil"},t)}function O(t,e){switch(t.case){case"nil":throw new Error("variable id out-of-bounds");case"cons":return 0===e?t.head:O(t.tail,e-1)}}function E(t){var e=k(t);console.log("termAnn: ".concat(y(e)));var a=function(t){var e=[];return function t(a){switch(a.case){case"unit":case"variable":return;case"abstraction":return void t(a.body);case"application":var c=[T(a.applicant),T(a.argument)],n=c[0],r=c[1];return e.push([n,{case:"arrow",domain:r,codomain:a.type}]),t(a.applicant),void t(a.argument);case"hole":return}}(t),e}(e);console.log("constraints: ...");var c=function(t){var e={case:"nil"};return t.forEach((function(t){var a=F(S(e,t[0]),S(e,t[1]));e=g(e,a)})),e}(a);console.log("substitution: ..."),e=C(c,e),console.log("substituted termAnn: ".concat(y(e)));var n=T(e);console.log("extracted type: ".concat(h(n)));var r=N(e);return console.log("holeContexts: ..."),{termAnn:e,type:n,substitution:c,holeContexts:r}}function C(t,e){switch(e.case){case"unit":return e;case"variable":return{case:"variable",id:e.id,type:S(t,e.type)};case"abstraction":return{case:"abstraction",body:C(t,e.body),type:S(t,e.type)};case"application":return{case:"application",applicant:C(t,e.applicant),argument:C(t,e.argument),type:S(t,e.type)};case"hole":return{case:"hole",id:e.id,type:S(t,e.type)}}}function N(t){var e=new Map;return function t(a,c){switch(console.log("context: ".concat(x(a))),c.case){case"unit":case"variable":return;case"abstraction":switch(c.type.case){case"arrow":return console.log("TEST: ".concat(x({case:"cons",head:c.type.domain,tail:a}))),void t({case:"cons",head:c.type.domain,tail:a},c.body);default:throw new Error("impossible")}case"application":t(a,c.applicant),t(a,c.argument);break;case"hole":e.set(c.id,p(a))}}({case:"nil"},t),e}function A(t,e,a){switch(a.case){case"unit":return a;case"variable":return a.id===t?e:a;case"arrow":return{case:"arrow",domain:A(t,e,a.domain),codomain:A(t,e,a.codomain)}}}function S(t,e){switch(t.case){case"nil":return e;case"cons":return A(t.key,t.value,S(t.tail,e))}}function F(t,e){switch(t.case){case"unit":switch(e.case){case"unit":return{case:"nil"};case"variable":return j(e.id,t);case"arrow":throw new Error("cannot unify ".concat(h(t)," with ").concat(h(e)))}break;case"variable":switch(e.case){case"unit":return{case:"nil"};case"variable":return t.id===e.id?{case:"nil"}:j(t.id,e);case"arrow":if(P(t.id,e))throw new Error("cannot unify ".concat(h(t)," with ").concat(h(e)," because of circularity on ").concat(v(t.id)));return j(t.id,e)}break;case"arrow":switch(e.case){case"unit":throw new Error("cannot unify ".concat(h(t)," with ").concat(h(e)));case"variable":if(P(e.id,e))throw new Error("cannot unify ".concat(h(t)," with ").concat(h(e)," because of circularity on ").concat(v(e.id)));return j(e.id,t);case"arrow":return g(F(t.domain,e.domain),F(t.codomain,e.codomain))}}throw new Error("impossible")}function P(t,e){switch(e.case){case"unit":return!1;case"variable":return t===e.id;case"arrow":return P(t,e.domain)||P(t,e.codomain)}}function T(t){switch(t.case){case"unit":return{case:"unit"};case"variable":case"abstraction":case"application":case"hole":return t.type}}function G(t){return"term: ".concat(b(t.term),"; type: ").concat(h(t.type),"; focus: ").concat(void 0!==(e=t.focus)?"id: ".concat(e.id,"; type: ").concat(h(e.type),"; context: ").concat(x(e.context),"; transitions: ").concat(e.transitions.map((function(t){return M(t)})).join(", ")):"unfocussed");var e}function M(t){switch(t.case){case"select":return"select hole id ".concat(t.id);case"put":return"put ".concat(B(t.put))}}function B(t){switch(t.case){case"unit":return"unit";case"variable":return f(t.id);case"abstraction":return"\u03bb ?";case"application":return"? ?"}}function I(t,e){switch(console.log("update"),console.log("input state: ".concat(G(t))),console.log("transition: ".concat(M(e))),e.case){case"select":var a,c=E(t.term),n=function(t,e){var a=void 0;if(function t(e){switch(e.case){case"unit":case"variable":return;case"abstraction":return void t(e.body);case"application":return t(e.applicant),void t(e.argument);case"hole":a=e.type}}(t),void 0!==a)return a;throw new Error("hole id ".concat(e," not found"))}(c.termAnn,e.id),r=N(c.termAnn),i=[];r.forEach((function(t,e){return i.push("".concat(w(e),": ").concat(x(t)))})),console.log("holeContexts: ".concat(i.join("; ")));var o=r.get(e.id);if(void 0===o)throw new Error("hole id ".concat(e.id," not found among hole contexts"));a=o,console.log("holeContext: ".concat(x(a)));var s=[],u=[];return u.push({case:"unit"}),u.push({case:"application"}),u.push({case:"abstraction"}),d(a).forEach((function(t,e){return u.push({case:"variable",id:e})})),u.forEach((function(a){var c;switch(a.case){case"unit":c={case:"unit"};break;case"variable":c={case:"variable",id:a.id};break;case"abstraction":c={case:"abstraction",body:{case:"hole",id:-1}};break;case"application":c={case:"application",applicant:{case:"hole",id:-1},argument:{case:"hole",id:-1}}}console.log("trying to fillHole ".concat(b(t.term)));var n=J(t.term,e.id,c);console.log("trying to enumerate ".concat(b(n))),n=L(n);try{console.log("trying to infer ".concat(b(n))),E(n),console.log("success for ".concat(b(n))),s.push({case:"put",put:a})}catch(r){console.log("".concat(B(a),' is an invalid "put" option because: ').concat(r))}})),{term:t.term,type:c.type,focus:{id:e.id,type:n,context:a,transitions:s}};case"put":var l,p=t.focus;switch(e.put.case){case"unit":l={case:"unit"};break;case"variable":l={case:"variable",id:e.put.id};break;case"abstraction":l={case:"abstraction",body:{case:"hole",id:-1}};break;case"application":l={case:"application",applicant:{case:"hole",id:-1},argument:{case:"hole",id:-1}}}var h=J(t.term,p.id,l);return{term:h=L(h),type:E(h).type,focus:void 0}}throw new Error("unimplemented")}function J(t,e,a){switch(t.case){case"unit":case"variable":return t;case"abstraction":return{case:"abstraction",body:J(t.body,e,a)};case"application":return{case:"application",applicant:J(t.applicant,e,a),argument:J(t.argument,e,a)};case"hole":return t.id===e?a:t}}function L(t){var e=0;return function t(a){switch(a.case){case"unit":case"variable":return a;case"abstraction":return{case:"abstraction",body:t(a.body)};case"application":return{case:"application",applicant:t(a.applicant),argument:t(a.argument)};case"hole":return function(){var t={case:"hole",id:e};return e++,t}()}}(t)}var q=a(0),z=function(t){Object(u.a)(a,t);var e=Object(l.a)(a);function a(){var t;Object(o.a)(this,a);for(var c=arguments.length,n=new Array(c),r=0;r<c;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))).state={term:{case:"hole",id:0},type:{case:"variable",id:0},focus:void 0},t}return Object(s.a)(a,[{key:"render",value:function(){return Object(q.jsxs)("div",{className:"App",children:[this.viewConsole(),Object(q.jsx)("hr",{}),this.viewGoal(),Object(q.jsx)("hr",{}),this.viewContext(),Object(q.jsx)("hr",{}),this.viewPalette()]})}},{key:"viewContext",value:function(){if(void 0!==this.state.focus){var t=[];return d(this.state.focus.context).forEach((function(e,a){return t.push(Object(q.jsxs)("div",{className:"context-variable",children:[f(a),": ",h(e)]}))})),Object(q.jsxs)("div",{className:"context",children:["Context: ",t]})}return Object(q.jsx)("div",{})}},{key:"viewGoal",value:function(){return void 0!==this.state.focus?Object(q.jsxs)("div",{className:"goal",children:["Goal: ",h(this.state.focus.type)]}):Object(q.jsx)("div",{})}},{key:"viewConsole",value:function(){var t=this;return Object(q.jsxs)("div",{className:"console",children:[function e(a){switch(a.case){case"unit":case"variable":return Object(q.jsx)("span",{children:b(a)});case"abstraction":var c=e(a.body);return Object(q.jsxs)("span",{children:["(\u03bb ",c,")"]});case"application":var n=e(a.applicant),r=e(a.argument);return Object(q.jsxs)("span",{children:["(",n," ",r,")"]});case"hole":var i=void 0!==t.state.focus&&t.state.focus.id===a.id?"hole focussed":"hole";return Object(q.jsx)("span",{className:i,onClick:function(e){return t.setState(I(t.state,{case:"select",id:a.id}))},children:w(a.id)})}}(this.state.term)," : ",h(this.state.type)]})}},{key:"viewPalette",value:function(){if(void 0!==this.state.focus){var t=this,e=[];return this.state.focus.transitions.forEach((function(a){switch(a.case){case"select":break;case"put":e.push(Object(q.jsx)("div",{className:"palette-item",onClick:function(e){return t.setState(I(t.state,a))},children:B(a.put)}))}})),Object(q.jsx)("div",{className:"palette",children:e})}return Object(q.jsx)("div",{})}}]),a}(n.a.Component),D=function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,16)).then((function(e){var a=e.getCLS,c=e.getFID,n=e.getFCP,r=e.getLCP,i=e.getTTFB;a(t),c(t),n(t),r(t),i(t)}))};i.a.render(Object(q.jsx)(n.a.StrictMode,{children:Object(q.jsx)(z,{})}),document.getElementById("root")),D()}},[[15,1,2]]]);
//# sourceMappingURL=main.3c220a3b.chunk.js.map