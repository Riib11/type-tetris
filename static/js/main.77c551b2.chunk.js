(this["webpackJsonptype-tetris"]=this["webpackJsonptype-tetris"]||[]).push([[0],{12:function(e,a,t){},13:function(e,a,t){},15:function(e,a,t){"use strict";t.r(a);var n=t(1),r=t.n(n),c=t(3),o=t.n(c),s=(t(12),t(4)),i=t(5),u=t(7),p=t(6);t(13);function l(e,a,t){switch(void 0===t&&(t=function(e,a){return e===a}),e.case){case"nil":return;case"cons":return e.key===a?e.value:l(e.tail,a,t)}}function m(e,a,t){return{case:"cons",key:e,value:a,tail:t}}function h(e){var a=[];return function e(t){switch(t.case){case"nil":return;case"cons":a.push([t.key,t.value]),e(t.tail)}}(e),a}function v(e,a){switch(e.case){case"nil":return a;case"cons":return v(e.tail,{case:"cons",key:e.key,value:e.value,tail:a})}}function d(e,a){return{case:"cons",key:e,value:a,tail:{case:"nil"}}}function b(e){switch(e.case){case"nil":return{case:"nil"};case"cons":return{case:"cons",key:e.key,value:e.value,tail:b(e.tail)}}}var j=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];function f(e){switch(e.case){case"unit":return"Unit";case"variable":return y(e.name);case"arrow":return"(".concat(f(e.domain)," \u2192 ").concat(f(e.codomain),")");case"product":return"(".concat(f(e.part1)," \xd7 ").concat(f(e.part2),")")}}function y(e){var a=j[e.id%j.length],t=e.id>j.length?Math.floor(e.id/j.length).toString():"";return"".concat(a).concat(t)}function w(e){switch(e.case){case"unit":return"unit";case"variable":return g(e.name);case"abstraction":return"(\u03bb ".concat(g(e.name)," . ").concat(w(e.body),")");case"application":return"(".concat(w(e.applicant)," ").concat(w(e.argument),")");case"pair":return"(".concat(w(e.proj1),", ").concat(w(e.proj2),")");case"proj1":return"(\u03c0\u2081 ".concat(w(e.argument),")");case"proj2":return"(\u03c0\u2082 ".concat(w(e.argument),")");case"hole":return x(e.name)}}function g(e){return"".concat(e.label)}function x(e){return"?".concat(e.id)}function k(e){switch(e.case){case"unit":return"unit";case"variable":return"(".concat(g(e.name),": ").concat(f(e.type),")");case"abstraction":return"(\u03bb ".concat(g(e.name)," . ").concat(k(e.body),"): ").concat(f(e.type));case"application":return"(".concat(k(e.applicant)," ").concat(k(e.argument),"): ").concat(f(e.type));case"pair":return"(".concat(k(e.proj1),", ").concat(k(e.proj2),"): ").concat(f(e.type));case"proj1":return"(\u03c0\u2081 ".concat(k(e.argument),"): ").concat(f(e.type)," (* ").concat(f(e.part2),")");case"proj2":return"(\u03c0\u2082 ".concat(k(e.argument),"): ").concat(f(e.type)," (").concat(f(e.part1)," *)");case"hole":return"(".concat(x(e.name),": ").concat(f(e.type),")")}}function O(e){switch(e.case){case"unit":return{case:"unit"};case"variable":case"abstraction":case"application":case"pair":case"proj1":case"proj2":case"hole":return e.type}}function E(e){var a=[];function t(e){switch(e.case){case"unit":return;case"variable":return void a.push(e.name);case"arrow":return t(e.domain),void t(e.domain);case"product":return t(e.part1),void t(e.part2)}}return C(e).forEach((function(e){return t(e)})),a}function C(e){var a=[];return function e(t){switch(t.case){case"unit":return;case"variable":return void a.push(t.type);case"abstraction":return a.push(t.type),void e(t.body);case"application":return a.push(t.type),e(t.applicant),void e(t.argument);case"pair":return a.push(t.type),e(t.proj1),void e(t.proj2);case"proj1":return a.push(t.type),a.push(t.part2),void e(t.argument);case"proj2":return a.push(t.type),a.push(t.part1),void e(t.argument);case"hole":return void a.push(t.type)}}(e),a}function N(e){var a=[];console.log("before enumeration: ".concat(k(e))),E(e).reverse().forEach((function(e){return function(e){a.includes(e)||(e.id=a.length,a.push(e))}(e)})),console.log("after enumeration: ".concat(k(e)))}function A(e){var a=0;(function(e){var a=[];return function e(t){switch(t.case){case"unit":case"variable":return;case"abstraction":return void e(t.body);case"application":return e(t.applicant),void e(t.argument);case"pair":return e(t.proj1),void e(t.proj2);case"proj1":case"proj2":return void e(t.argument);case"hole":return void a.push(t.name)}}(e),a.reverse()})(e).forEach((function(e){return function(e){e.id=a,a++}(e)}))}function S(e){return e.map((function(e){return"".concat(f(e[0])," ~ ").concat(f(e[1]))})).join(", ")}function F(e){var a={case:"nil"};return e.forEach((function(e){var t=M(I(a,e[0]),I(a,e[1]));a=v(a,t)})),a}function M(e,a){switch(e.case){case"unit":switch(a.case){case"unit":return{case:"nil"};case"variable":return d(a.name,e);case"arrow":case"product":throw P(e,a)}break;case"variable":switch(a.case){case"unit":return d(e.name,a);case"variable":return e.name===a.name?{case:"nil"}:d(e.name,a);case"arrow":case"product":return T(e.name,a),d(e.name,a)}break;case"arrow":switch(a.case){case"unit":throw P(e,a);case"variable":return T(a.name,e),d(a.name,e);case"arrow":return v(M(e.domain,a.domain),M(a.codomain,e.codomain));case"product":throw P(e,a)}break;case"product":switch(a.case){case"unit":throw P(e,a);case"variable":return T(a.name,e),d(a.name,e);case"arrow":throw new Error("cannot unify ".concat(f(e)," with ").concat(f(a)));case"product":return v(M(e.part1,a.part1),M(e.part2,a.part2))}}throw new Error("impossible: ".concat(f(e)," ~ ").concat(f(a)))}function P(e,a){return new Error("cannot unify ".concat(f(e)," with ").concat(f(a)))}function T(e,a){if(L(e,a))throw new Error("cannot unify ".concat(f({case:"variable",name:e})," with ").concat(f(a)," because of circularity on ").concat(y(e)))}function L(e,a){switch(a.case){case"unit":return!1;case"variable":return e===a.name;case"arrow":return L(e,a.domain)||L(e,a.codomain);case"product":return L(e,a.part1)||L(e,a.part2)}}function B(e,a){switch(a.case){case"unit":return a;case"variable":return{case:"variable",name:a.name,type:I(e,a.type)};case"abstraction":return{case:"abstraction",name:a.name,body:B(e,a.body),type:I(e,a.type)};case"application":return{case:"application",applicant:B(e,a.applicant),argument:B(e,a.argument),type:I(e,a.type)};case"pair":return{case:"pair",proj1:B(e,a.proj1),proj2:B(e,a.proj2),type:I(e,a.type)};case"proj1":return{case:"proj1",argument:B(e,a.argument),type:I(e,a.type),part2:I(e,a.part2)};case"proj2":return{case:"proj2",argument:B(e,a.argument),type:I(e,a.type),part1:I(e,a.part1)};case"hole":return{case:"hole",name:a.name,type:I(e,a.type)}}}function G(e,a,t){switch(t.case){case"unit":return t;case"variable":return t.name===e?a:t;case"arrow":return{case:"arrow",domain:G(e,a,t.domain),codomain:G(e,a,t.codomain)};case"product":return{case:"product",part1:G(e,a,t.part1),part2:G(e,a,t.part2)}}}function I(e,a){return function e(a,t){switch(a.case){case"nil":return t;case"cons":return G(a.key,a.value,e(a.tail,t))}}(e,a)}function J(e){return h(e).map((function(e){return"".concat(g(e[0]),": ").concat(f(e[1]))})).join(", ")}function q(e){console.log("------------------------------------------------------");var a=function(e){function a(e,t){switch(t.case){case"unit":return{case:"unit"};case"variable":return{case:"variable",name:t.name,type:z(e,t.name)};case"abstraction":var n={case:"variable",name:{id:-1}},r=a(m(t.name,n,e),t.body);return{case:"abstraction",name:t.name,body:r,type:{case:"arrow",domain:n,codomain:O(r)}};case"application":return{case:"application",applicant:a(e,t.applicant),argument:a(e,t.argument),type:{case:"variable",name:{id:-1}}};case"pair":return{case:"pair",proj1:a(e,t.proj1),proj2:a(e,t.proj2),type:{case:"variable",name:{id:-1}}};case"proj1":return{case:"proj1",argument:a(e,t.argument),type:{case:"variable",name:{id:-1}},part2:{case:"variable",name:{id:-1}}};case"proj2":return{case:"proj2",argument:a(e,t.argument),type:{case:"variable",name:{id:-1}},part1:{case:"variable",name:{id:-1}}};case"hole":return{case:"hole",name:t.name,type:{case:"variable",name:{id:-1}}}}}console.log("annotatingL ".concat(w(e)));var t=a({case:"nil"},e);return N(t),t}(e);console.log("orig termAnn: ".concat(k(a)));var t=function(e){var a=[e],t=[];for(;;){var n=a.pop();if(void 0===n)break;switch(n.case){case"unit":case"variable":break;case"abstraction":a.push(n.body);break;case"application":var r=[O(n.applicant),O(n.argument)],c=r[0],o=r[1];a.push(n.argument),a.push(n.applicant),t.push([c,{case:"arrow",domain:o,codomain:O(n)}]);break;case"pair":var s=[O(n.proj1),O(n.proj2)],i=s[0],u=s[1];a.push(n.proj1),a.push(n.proj2),t.push([{case:"product",part1:i,part2:u},n.type]);break;case"proj1":a.push(n.argument),t.push([O(n.argument),{case:"product",part1:O(n),part2:n.part2}]),console.log("constraint from proj1: ".concat(S([[{case:"product",part1:O(n),part2:n.part2},O(n.argument)]])));break;case"proj2":a.push(n.argument),t.push([{case:"product",part1:n.part1,part2:O(n)},O(n.argument)]),console.log("constraint from proj2: ".concat(S([[{case:"product",part1:n.part1,part2:O(n)},O(n.argument)]])));break;case"hole":break;default:throw new Error("impossible")}}return t.reverse()}(a);console.log("constraints: ".concat(S(t)));var n=F(t);return console.log("substitution: ".concat(h(n).map((function(e){return"".concat(y(e[0])," := ").concat(f(e[1]))})).join(", "))),N(a=B(n,a)),console.log("result termAnn: ".concat(k(a))),{termAnn:a,type:O(a),substitution:n,holeContexts:function(e){var a=new Map;function t(e,n){switch(n.case){case"unit":case"variable":return;case"abstraction":switch(n.type.case){case"arrow":return void t(m(n.name,n.type.domain,e),n.body);default:throw new Error("impossible")}case"application":t(e,n.applicant),t(e,n.argument);break;case"pair":t(e,n.proj1),t(e,n.proj2);break;case"proj1":case"proj2":return void t(e,n.argument);case"hole":a.set(n.name,b(e))}}return t({case:"nil"},e),a}(a),holeTypes:function(e){var a=new Map;return function e(t){switch(t.case){case"unit":case"variable":return;case"abstraction":return void e(t.body);case"application":return e(t.applicant),void e(t.argument);case"pair":return e(t.proj1),void e(t.proj2);case"proj1":case"proj2":return void e(t.argument);case"hole":return void a.set(t.name,t.type)}}(e),a}(a)}}function z(e,a){var t=l(e,a);if(void 0!==t)return t;throw new Error("variable name ".concat(g(a)," not found in context ").concat(J(e)))}function D(e){switch(e.case){case"unit":return"unit";case"variable":return g(e.name);case"abstraction":return"\u03bb ?";case"application":return"? ?";case"pair":return"(? , ?)";case"proj1":return"\u03c0\u2081 ?";case"proj2":return"\u03c0\u2082 ?"}}function U(e,a){switch(a.case){case"select":var t=q(e.term),n=function(e,a){var t=a.holeContexts.get(e);if(void 0!==t)return t;throw new Error("hole ".concat(x(e)," not found in ").concat(k(a.termAnn)))}(a.name,t),r=function(e,a){var t=a.holeTypes.get(e);if(void 0!==t)return t;throw new Error("hole ".concat(x(e)," not found in ").concat(k(a.termAnn)))}(a.name,t),c=[],o=[];return o.push({case:"unit"}),o.push({case:"application"}),o.push({case:"abstraction"}),o.push({case:"pair"}),o.push({case:"proj1"}),o.push({case:"proj2"}),h(n).forEach((function(e){return o.push({case:"variable",name:e[0]})})),o.forEach((function(t){var n=H(t),r=K(e.term,a.name,n);A(r);try{q(r),c.push({case:"put",put:t})}catch(o){console.log("failed inference: ".concat(o))}})),{term:e.term,type:t.type,focus:{name:a.name,type:r,context:n,transitions:c}};case"put":var s=e.focus,i=H(a.put),u=K(e.term,s.name,i);return A(u),{term:u,type:q(u).type,focus:void 0};case"relabel":return function(e,a,t){!function t(n){switch(n.case){case"unit":return;case"variable":return void(e===n.name&&(n.name.label=a));case"abstraction":return e===n.name&&(n.name.label=a),void t(n.body);case"application":return t(n.applicant),void t(n.argument);case"pair":return t(n.proj1),void t(n.proj2);case"proj1":case"proj2":return void t(n.argument);case"hole":return}}(t)}(a.name,a.label,e.term),{term:e.term,type:e.type,focus:void 0}}}function H(e){switch(e.case){case"unit":return{case:"unit"};case"variable":return{case:"variable",name:e.name};case"abstraction":return{case:"abstraction",name:{label:"x"},body:{case:"hole",name:{id:-1}}};case"application":return{case:"application",applicant:{case:"hole",name:{id:-1}},argument:{case:"hole",name:{id:-1}}};case"pair":return{case:"pair",proj1:{case:"hole",name:{id:-1}},proj2:{case:"hole",name:{id:-1}}};case"proj1":return{case:"proj1",argument:{case:"hole",name:{id:-1}}};case"proj2":return{case:"proj2",argument:{case:"hole",name:{id:-1}}}}}function K(e,a,t){switch(e.case){case"unit":case"variable":return e;case"abstraction":return{case:"abstraction",name:e.name,body:K(e.body,a,t)};case"application":return{case:"application",applicant:K(e.applicant,a,t),argument:K(e.argument,a,t)};case"pair":return{case:"pair",proj1:K(e.proj1,a,t),proj2:K(e.proj2,a,t)};case"proj1":return{case:"proj1",argument:K(e.argument,a,t)};case"proj2":return{case:"proj2",argument:K(e.argument,a,t)};case"hole":return e.name===a?t:e}}var Q=t(0),R=function(e){Object(u.a)(t,e);var a=Object(p.a)(t);function t(){var e;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=a.call.apply(a,[this].concat(r))).state={term:{case:"hole",name:{id:0}},type:{case:"variable",name:{id:0}},focus:void 0},e}return Object(i.a)(t,[{key:"render",value:function(){return Object(Q.jsxs)("div",{className:"App",children:[this.viewConsole(),this.viewEnvironment(),this.viewPalette()]})}},{key:"viewEnvironment",value:function(){return void 0!==this.state.focus?Object(Q.jsxs)("div",{className:"environment",children:[this.viewContext(),Object(Q.jsx)("hr",{}),this.viewGoal()]}):Object(Q.jsx)("div",{})}},{key:"viewContext",value:function(){if(void 0!==this.state.focus){var e=[];return h(this.state.focus.context).forEach((function(a){return e.push(Object(Q.jsxs)("div",{className:"context-variable",children:[g(a[0]),": ",f(a[1])]}))})),Object(Q.jsx)("div",{className:"context",children:e})}return Object(Q.jsx)("div",{})}},{key:"viewGoal",value:function(){return void 0!==this.state.focus?Object(Q.jsx)("div",{className:"goal",children:f(this.state.focus.type)}):Object(Q.jsx)("div",{})}},{key:"viewConsole",value:function(){var e=this;return Object(Q.jsxs)("div",{className:"console",children:[function a(t){switch(t.case){case"unit":case"variable":return Object(Q.jsx)("span",{children:w(t)});case"abstraction":var n=a(t.body),r=g(t.name),c=Object(Q.jsx)("input",{className:"variable",type:"text",value:r,onChange:function(a){var n=a.target;n.style.width="".concat(8*(n.value.length+1),"px"),e.setState(U(e.state,{case:"relabel",name:t.name,label:n.value}))},style:{width:"".concat(8*(r.length+1),"px")}});return Object(Q.jsxs)("span",{children:["(\u03bb ",c," . ",n,")"]});case"application":var o=a(t.applicant),s=a(t.argument);return Object(Q.jsxs)("span",{children:["(",o," ",s,")"]});case"pair":var i=a(t.proj1),u=a(t.proj2);return Object(Q.jsxs)("span",{children:["(",i,", ",u,")"]});case"proj1":var p=a(t.argument);return Object(Q.jsxs)("span",{children:["(\u03c0\u2081 ",p,")"]});case"proj2":var l=a(t.argument);return Object(Q.jsxs)("span",{children:["(\u03c0\u2082 ",l,")"]});case"hole":var m=void 0!==e.state.focus&&e.state.focus.name===t.name?"hole focussed":"hole";return Object(Q.jsx)("span",{className:m,onClick:function(a){return e.setState(U(e.state,{case:"select",name:t.name}))},children:x(t.name)})}}(this.state.term)," : ",f(this.state.type)]})}},{key:"viewPalette",value:function(){if(void 0!==this.state.focus){var e=this,a=[];return this.state.focus.transitions.forEach((function(t){switch(t.case){case"select":break;case"put":a.push(Object(Q.jsx)("div",{children:Object(Q.jsx)("div",{className:"palette-item",onClick:function(a){return e.setState(U(e.state,t))},children:D(t.put)})}))}})),Object(Q.jsx)("div",{className:"palette",children:a})}return Object(Q.jsx)("div",{})}}]),t}(r.a.Component),V=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,16)).then((function(a){var t=a.getCLS,n=a.getFID,r=a.getFCP,c=a.getLCP,o=a.getTTFB;t(e),n(e),r(e),c(e),o(e)}))};o.a.render(Object(Q.jsx)(r.a.StrictMode,{children:Object(Q.jsx)(R,{})}),document.getElementById("root")),V()}},[[15,1,2]]]);
//# sourceMappingURL=main.77c551b2.chunk.js.map